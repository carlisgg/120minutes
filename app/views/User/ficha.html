#{extends 'main.html' /}
#{set title:'120minutos - Ficha de usuario' /}

<div class="row">
	<div class="span12 grey-background">
	
		<div class="row">
			<div class="span10 offset1">
            #{if user.email == session.username}
				<h3>Tu perfil</h3>
            #{/if}
            #{else}
                <h3>Perfil de usuario</h3>
            #{/else}
			</div>
		</div>
		
		<div class="row">
			<div class="span2 offset1">
				<img src="@{'/public/images/recurso-foto-ficha.gif'}" class="img-polaroid">
			</div>
			<div class="span8">
				<h4>${user.username}</h4>
				<p>
					${user.descripcion}
				</p>
			</div>
		</div>
		
		<div class="row row-top-bottom-separator">
			<div class="span10 offset1">
				<div class="tabbable"> <!-- Only required for left/right tabs -->
					<ul class="nav nav-tabs">
                        #{if user.email == session.username}
                            <li>
                                <a href="#ensenando" data-toggle="tab">Estoy ense&ntilde;ando</a>
                            </li>
                            <li>
                                <a href="#aprendiendo" data-toggle="tab">Estoy aprendiendo</a>
                            </li>
                        #{/if}
						<li>
							<a href="#puedo" data-toggle="tab">Puedo ense&ntilde;ar</a>
						</li>
                        #{if user.email == session.username}
                            <li>
                                <a href="#quiero" data-toggle="tab">Quiero aprender</a>
                            </li>
                        #{/if}
					</ul>


					<div class="tab-content profile-tab-content">

                    #{if user.email == session.username}
						<div class="tab-pane active" id="ensenando">
							<table class="table table-condensed">
								<thead>
									<tr>
										<th>
											<h4 class="position-ico ico-tema">Tema</h4>
										</th>
										<th>
											<h4 class="position-ico ico-autor">Interesado</h4>
										</th>
										<th>
											&nbsp;
										</th>
									</tr>
								</thead>
								<tbody>
									#{list items:user.findEncuentrosOfrecidos(), as:'encuentroComoOfertante'}
									<tr>
										<td>
											<h5>
							        			<a href="/">
							        				${encuentroComoOfertante.tema.titulo}
							        			</a>
							        		</h5>
							        		<p>
							        			${encuentroComoOfertante.tema.descripcion}
							        		</p>
										</td>
										<td>
											<h5>
												<a href="@{User.ficha(encuentroComoOfertante.interesado.id)}#puedo">
							        				${encuentroComoOfertante.interesado.username}
							        			</a>
							        		</h5>
										</td>
										<td>
                                            <h5></h5>

                                            #{if (encuentroComoOfertante.estadoExperto == models.Encuentro.Estado.Solicitado)}
												<a href="@{Admin.confirmarEncuentro(encuentroComoOfertante.id)}">
													<i class="icon-ok"></i> Confirmar
												</a>
												<div class="separador-acciones"></div>
												<a href="@{Admin.rechazarEncuentro(encuentroComoOfertante.id)}">
													<i class="icon-remove"></i> Rechazar
												</a>
											#{/if}
											#{elseif ((encuentroComoOfertante.estadoExperto == models.Encuentro.Estado.Rechazado))}
												<span class="label label-important">Rechazado</span>
											#{/elseif}
											#{elseif ((encuentroComoOfertante.estadoExperto == models.Encuentro.Estado.Cancelado))}
												<span class="label label-important">Cancelado</span>
											#{/elseif}
											#{elseif ((encuentroComoOfertante.estadoExperto == models.Encuentro.Estado.Aceptado))}
												<a href="@{Admin.finalizarEncuentroOfertante(encuentroComoOfertante.id)}">
													<i class="icon-ok"></i> Finalizar
												</a>
											#{/elseif}
											#{elseif ((encuentroComoOfertante.estadoExperto == models.Encuentro.Estado.Finalizado))}
												<h5>
								        			Puntua el encuentro
								        		</h5>
								        		<div>
								        			<ul class="horizontal-list">
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star icon-white"></i>
								        				</li>
								        			</ul>
								        		</div>
											#{/elseif}
											#{elseif ((encuentroComoOfertante.estadoExperto == models.Encuentro.Estado.Votado))}
								        		<div>
								        			<ul class="horizontal-list">
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star"></i>
								        				</li>
								        				<li>
								        					<i class="icon-star icon-white"></i>
								        				</li>
								        			</ul>
								        		</div>
											#{/elseif}
										</td>
									</tr>
									#{/list}
								</tbody>
							</table>
						</div>
						<div class="tab-pane active" id="aprendiendo">							
							<table class="table table-condensed">
								<thead>
									<tr>
										<th>
											<h4 class="position-ico ico-tema">Tema</h4>
										</th>
										<th>
											<h4 class="position-ico ico-autor">Usuario</h4>
										</th>
										<th>
											&nbsp;
										</th>
									</tr>
								</thead>
								<tbody>
									#{list items:user.encuentrosSolicitados, as:'encuentroComoSolicitante'}
									<tr>
										<td>
											<h5>
							        			<a href="/">
							        				${encuentroComoSolicitante.tema.titulo}
							        			</a>
							        		</h5>
							        		<p>
							        			${encuentroComoSolicitante.tema.descripcion}
							        		</p>
										</td>
										<td>
											<h5>
												<a href="@{User.ficha(encuentroComoSolicitante.tema.experto.id)}#puedo">
							        				${encuentroComoSolicitante.tema.experto.username}
							        			</a>
							        		</h5>
										</td>
										<td>
											#{if (encuentroComoSolicitante.estadoInteresado == models.Encuentro.Estado.Solicitado)}
											        <span class="label label-info">Esperando confirmacion</span>
                                                    <div class="separador-acciones"></div>
											        <a href="@{Admin.cancelarEncuentro(encuentroComoSolicitante.id)}">
											        	<i class="icon-remove"></i> Cancelar
											        </a>
											#{/if}
											#{elseif ((encuentroComoSolicitante.estadoInteresado == models.Encuentro.Estado.Rechazado))}
													<span class="label label-important">Rechazado</span>
											#{/elseif}
											#{elseif ((encuentroComoSolicitante.estadoInteresado == models.Encuentro.Estado.Cancelado))}
													<span class="label label-important">Cancelado</span>
											#{/elseif}
											#{elseif ((encuentroComoSolicitante.estadoInteresado == models.Encuentro.Estado.Aceptado))}
													<a href="@{Admin.finalizarEncuentroSolicitante(encuentroComoSolicitante.id)}">
														<i class="icon-ok"></i> Finalizar
													</a>
											#{/elseif}
											#{elseif ((encuentroComoSolicitante.estadoInteresado == models.Encuentro.Estado.Finalizado))}
													<h5>
									        			Puntua el encuentro
									        		</h5>
									        		<div>
									        			<ul class="horizontal-list">
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star icon-white"></i>
									        				</li>
									        			</ul>
									        		</div>
											#{/elseif}
											#{elseif ((encuentroComoSolicitante.estadoInteresado == models.Encuentro.Estado.Votado))}
									        		<div>
									        			<ul class="horizontal-list">
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star"></i>
									        				</li>
									        				<li>
									        					<i class="icon-star icon-white"></i>
									        				</li>
									        			</ul>
									        		</div>
											#{/elseif}
										</td>
									</tr>
									#{/list}
								</tbody>
							</table>
							
						</div>

                        #{/if}
						<div class="tab-pane" id="puedo">
							<table class="table table-condensed">
								<thead>
									<tr>
										<th>
											<h4 class="position-ico ico-tema">Temas de los que puedo enseñar</h4>
										</th>
										<th>
											&nbsp;
										</th>
									</tr>
								</thead>
								<tbody>
									#{list items:user.temas, as:'tema'}
									<tr>
										<td>
											<h5>
							        			<a href="/">
							        				${tema.titulo}
							        			</a>
							        		</h5>
							        		<p>
							        			${tema.descripcion}
							        		</p>
										</td>
                                    #{if user.email == session.username}
										<td>
											<a href="#"><i class="icon-remove"></i> Eliminar</a>
                                            <div class="separador-acciones"></div>
											<a href="#"><i class="icon-pencil"></i> Editar</a>
										</td>
                                    #{/if}
									</tr>
									#{/list}
                                    #{if user.email == session.username}
                                        <tr>
                                            <td colspan="2">
                                                #{ifErrors}
                                                    <span class="badge badge-important">
                                                    ${errors[0]}
                                                    </span>
                                                #{/ifErrors}

                                                #{form @User.add_tema()}
                                                    <div class="control-group">
                                                    	<label for="titulo">Dinos lo que puedes enseñar en 120 minutos</label>
                                                    	<input id="titulo" name="tema.titulo" value="${flash['tema.titulo']}" type="text" size="140" />
                                                    </div>
                                                    <div class="control-group">
                                                    	<label for="descripcion">Describe un poco más cómo lo vas a hacer</label>
                                                    	<textarea id="descripcion" name="tema.descripcion" value="${flash['tema.descripcion']}" type="text" size="140"></textarea>
													</div>
													<div class="control-group">
                                                    	<button type="submit" class="btn">
                                                    		<i class="icon-plus"></i> Añadir tema
                                                    	</button>
													</div>
                                                #{/form}

                                            </td>
                                        </tr>
                                    #{/if}
								</tbody>
							</table>
						</div>

                    #{if user.email == session.username}
						<div class="tab-pane" id="quiero">
							<table class="table table-condensed">
								<thead>
									<tr>
										<th>
											<h4 class="position-ico ico-tema">Cosas que me interesa aprender</h4>
										</th>
										<th>
											&nbsp;
										</th>
									</tr>
								</thead>
								<tbody>
									#{list items:user.intereses, as:'interes'}
									<tr>
										<td>
											<h5>
							        			<a href="/">
							        				${interes.texto}
							        			</a>
							        		</h5>
										</td>
										<td>
                                            <h5></h5>
											<a href="#"><i class="icon-remove"></i> Eliminar</a>
										</td>
									</tr>
									#{/list}
								</tbody>
							</table>
						</div>
                    #{/if}
					</div>
				</div>
			</div>
		</div>
		
	</div>
</div>
